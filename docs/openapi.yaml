openapi: 3.1.0
info:
  title: HelpDesk API (AS-IS)
  version: 0.1.0
  description: OpenAPI baseline reflecting currently implemented routes.
servers:
  - url: https://example.com
    description: Replace with deployment host
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: next-auth.session-token
  schemas:
    ErrorAsIs:
      type: object
      properties:
        error:
          oneOf:
            - type: string
            - type: object
              additionalProperties: true
    UserSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [REQUESTER, AGENT, ADMIN]
        organizationId:
          type: string
          format: uuid
        emailVerified:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        ticketCount:
          type: integer
          description: Total tickets created by this user
        activeTicketCount:
          type: integer
          description: Active tickets assigned to this user
      additionalProperties: true
    TeamSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        organizationId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        memberCount:
          type: integer
          description: Number of team members
        activeTicketCount:
          type: integer
          description: Active tickets assigned to this team
      additionalProperties: true
    Ticket:
      type: object
      properties:
        id:
          type: string
          format: uuid
        number:
          type: integer
        title:
          type: string
        descriptionMd:
          type: string
        status:
          type: string
          enum: [NOWE, W_TOKU, OCZEKUJE_NA_UZYTKOWNIKA, WSTRZYMANE, ROZWIAZANE, ZAMKNIETE, PONOWNIE_OTWARTE]
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        category:
          type: string
          nullable: true
        requesterId:
          type: string
          format: uuid
        assigneeUserId:
          type: string
          format: uuid
          nullable: true
        assigneeTeamId:
          type: string
          format: uuid
          nullable: true
        organizationId:
          type: string
          format: uuid
        firstResponseAt:
          type: string
          format: date-time
          nullable: true
        firstResponseDue:
          type: string
          format: date-time
          nullable: true
        resolveDue:
          type: string
          format: date-time
          nullable: true
        resolvedAt:
          type: string
          format: date-time
          nullable: true
        closedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    TicketExpanded:
      allOf:
        - $ref: '#/components/schemas/Ticket'
        - type: object
          properties:
            requester:
              $ref: '#/components/schemas/UserSummary'
            assigneeUser:
              $ref: '#/components/schemas/UserSummary'
            assigneeTeam:
              $ref: '#/components/schemas/TeamSummary'
    TicketCreate:
      type: object
      required: [title, descriptionMd, priority]
      properties:
        title:
          type: string
          minLength: 3
        descriptionMd:
          type: string
          minLength: 3
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        category:
          type: string
          nullable: true
    TicketUpdate:
      type: object
      description: Must include at least one of the fields below; requester-only updates are limited to closing/reopening.
      properties:
        status:
          type: string
          enum: [NOWE, W_TOKU, OCZEKUJE_NA_UZYTKOWNIKA, WSTRZYMANE, ROZWIAZANE, ZAMKNIETE, PONOWNIE_OTWARTE]
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        assigneeUserId:
          type: string
          format: uuid
          nullable: true
        assigneeTeamId:
          type: string
          format: uuid
          nullable: true
    Comment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        ticketId:
          type: string
          format: uuid
        authorId:
          type: string
          format: uuid
        isInternal:
          type: boolean
        bodyMd:
          type: string
        createdAt:
          type: string
          format: date-time
    CommentCreate:
      type: object
      required: [bodyMd]
      properties:
        bodyMd:
          type: string
          minLength: 1
        isInternal:
          type: boolean
          default: false
    AdminAuditEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        action:
          type: string
          enum: [CREATE, UPDATE, DELETE]
        resource:
          type: string
          enum: [USER, TEAM, TAG, SLA]
        resourceId:
          type: string
        actorId:
          type: string
          format: uuid
        actor:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
              nullable: true
            email:
              type: string
              format: email
        data:
          type: object
          nullable: true
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
    PageInfo:
      type: object
      properties:
        limit:
          type: integer
        offset:
          type: integer
        total:
          type: integer
    WorkerQueueJob:
      type: object
      properties:
        jobId:
          type: string
          format: uuid
        jobType:
          type: string
          description: |-
            Worker queue job type (e.g., `slaBreach`, `slaReminder`, `notificationDispatch`).
        ticketId:
          type: string
          format: uuid
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        dueAt:
          type: string
          format: date-time
        payload:
          type: object
          additionalProperties: true
      example:
        jobId: 123e4567-e89b-12d3-a456-426655440000
        jobType: slaBreach
        ticketId: 111e4567-e89b-12d3-a456-426655440001
        priority: WYSOKI
        dueAt: 2025-12-22T10:00:00Z
        payload:
          breachType: resolve
    WorkerEvent:
      type: object
      properties:
        eventId:
          type: string
          format: uuid
        eventType:
          type: string
          enum: [slaBreach, slaReminder, notificationSent]
        occurredAt:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
        job:
          $ref: '#/components/schemas/WorkerQueueJob'
      example:
        eventId: 223e4567-e89b-12d3-a456-426655440002
        eventType: slaBreach
        occurredAt: 2025-12-22T10:05:00Z
        metadata:
          breachedDurationSeconds: 3600
        job:
          jobId: 123e4567-e89b-12d3-a456-426655440000
          jobType: slaBreach
    NotificationEnvelope:
      type: object
      properties:
        channel:
          type: string
          enum: [email, inApp]
        recipientId:
          type: string
          format: uuid
        subject:
          type: string
        body:
          type: string
        metadata:
          type: object
          additionalProperties: true
      example:
        channel: email
        recipientId: 333e4567-e89b-12d3-a456-426655440003
        subject: "Ticket SLA reminder"
        body: "SLA breach is imminent; please respond."
        metadata:
          ticketId: 111e4567-e89b-12d3-a456-426655440001
    UserCreate:
      type: object
      required: [email, name, role, password]
      properties:
        email:
          type: string
          format: email
        name:
          type: string
          minLength: 1
        role:
          type: string
          enum: [REQUESTER, AGENT, ADMIN]
        password:
          type: string
          minLength: 8
    UserUpdate:
      type: object
      properties:
        email:
          type: string
          format: email
        name:
          type: string
          minLength: 1
        role:
          type: string
          enum: [REQUESTER, AGENT, ADMIN]
        password:
          type: string
          minLength: 8
    TeamCreate:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 1
    TeamUpdate:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 1
    TeamMembership:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        user:
          $ref: '#/components/schemas/UserSummary'
        joinedAt:
          type: string
          format: date-time
    InAppNotification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        type:
          type: string
        title:
          type: string
        message:
          type: string
        readAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
    Attachment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        ticketId:
          type: string
          format: uuid
        filename:
          type: string
        originalName:
          type: string
        mimeType:
          type: string
        sizeBytes:
          type: integer
        uploadedById:
          type: string
          format: uuid
        uploadedBy:
          $ref: '#/components/schemas/UserSummary'
        visibility:
          type: string
          enum: [INTERNAL, PUBLIC]
        scanStatus:
          type: string
          enum: [PENDING, CLEAN, INFECTED, ERROR]
        createdAt:
          type: string
          format: date-time
    AttachmentUploadRequest:
      type: object
      required: [filename, sizeBytes, mimeType]
      properties:
        filename:
          type: string
          minLength: 1
        sizeBytes:
          type: integer
          minimum: 1
        mimeType:
          type: string
          minLength: 1
    AttachmentUploadResponse:
      type: object
      properties:
        attachment:
          $ref: '#/components/schemas/Attachment'
        uploadUrl:
          type: string
          description: Presigned URL for file upload
        expiresAt:
          type: string
          format: date-time
    AuditEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        action:
          type: string
          enum: [STATUS_CHANGE, ASSIGNMENT_CHANGE, COMMENT_ADDED, ATTACHMENT_ADDED, SLA_BREACH, SLA_REMINDER]
        actorId:
          type: string
          format: uuid
          nullable: true
        actor:
          $ref: '#/components/schemas/UserSummary'
        details:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
    CsatResponse:
      type: object
      required: [rating]
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
        feedback:
          type: string
    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        organizationId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
    Tag:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        organizationId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
    SlaPreviewRequest:
      type: object
      required: [priority]
      properties:
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        category:
          type: string
          nullable: true
    SlaPreviewResponse:
      type: object
      properties:
        firstResponseDue:
          type: string
          format: date-time
          nullable: true
        resolveDue:
          type: string
          format: date-time
          nullable: true
    SavedView:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        organizationId:
          type: string
          format: uuid
        name:
          type: string
        filters:
          type: object
          additionalProperties: true
        isDefault:
          type: boolean
        isShared:
          type: boolean
        isTeam:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    SlaPolicy:
      type: object
      properties:
        id:
          type: string
          format: uuid
        organizationId:
          type: string
          format: uuid
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        categoryId:
          type: string
          format: uuid
          nullable: true
        category:
          $ref: '#/components/schemas/Category'
          nullable: true
        firstResponseHours:
          type: integer
        resolveHours:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    SlaPolicyCreate:
      type: object
      required: [priority, firstResponseHours, resolveHours]
      properties:
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        categoryId:
          type: string
          format: uuid
          nullable: true
        firstResponseHours:
          type: integer
          minimum: 1
        resolveHours:
          type: integer
          minimum: 1
    SlaPolicyUpdate:
      type: object
      properties:
        priority:
          type: string
          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        categoryId:
          type: string
          format: uuid
          nullable: true
        firstResponseHours:
          type: integer
          minimum: 1
        resolveHours:
          type: integer
          minimum: 1
    AutomationRule:
      type: object
      properties:
        id:
          type: string
          format: uuid
        organizationId:
          type: string
          format: uuid
        name:
          type: string
        enabled:
          type: boolean
        triggerConfig:
          type: object
          additionalProperties: true
        actionConfig:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    AutomationRuleCreate:
      type: object
      required: [name, triggerConfig, actionConfig]
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        triggerConfig:
          type: object
          additionalProperties: true
        actionConfig:
          type: object
          additionalProperties: true
    AutomationRuleUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        enabled:
          type: boolean
        triggerConfig:
          type: object
          additionalProperties: true
        actionConfig:
          type: object
          additionalProperties: true
  parameters:
    Limit:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 50
        default: 10
    Offset:
      name: offset
      in: query
      schema:
        type: integer
        minimum: 0
        default: 0
paths:
  /api/tickets:
    get:
      summary: List tickets
      description: |
        Returns tickets scoped by user role and organization.
        
        - REQUESTER role: Returns only tickets created by the user
        - AGENT/ADMIN roles: Returns tickets within the user's organization
        
        Supports filtering by status, priority, category, tags, date ranges, assignees, and text search.
        Uses cursor-based pagination for efficient navigation.
      security:
        - cookieAuth: []
      parameters:
        - name: limit
          in: query
          description: Number of tickets per page (1-100, default: 20)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: cursor
          in: query
          description: Base64-encoded cursor for pagination
          schema:
            type: string
        - name: direction
          in: query
          description: Pagination direction
          schema:
            type: string
            enum: [next, prev]
            default: next
        - name: status
          in: query
          description: Filter by ticket status
          schema:
            type: string
            enum: [NOWE, W_TOKU, OCZEKUJE_NA_UZYTKOWNIKA, WSTRZYMANE, ROZWIAZANE, ZAMKNIETE, PONOWNIE_OTWARTE]
        - name: priority
          in: query
          description: Filter by ticket priority
          schema:
            type: string
            enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        - name: q
          in: query
          description: Search in title and description (case-insensitive)
          schema:
            type: string
        - name: category
          in: query
          description: Filter by category ID
          schema:
            type: string
        - name: tags
          in: query
          description: Tag IDs (comma-separated)
          schema:
            type: string
        - name: createdAtFrom
          in: query
          description: Filter tickets created on or after this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: createdAtTo
          in: query
          description: Filter tickets created on or before this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: updatedAtFrom
          in: query
          description: Filter tickets updated on or after this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: updatedAtTo
          in: query
          description: Filter tickets updated on or before this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: resolvedAtFrom
          in: query
          description: Filter tickets resolved on or after this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: resolvedAtTo
          in: query
          description: Filter tickets resolved on or before this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: assigneeUserId
          in: query
          description: Filter tickets assigned to a specific user
          schema:
            type: string
            format: uuid
        - name: assigneeTeamId
          in: query
          description: Filter tickets assigned to a specific team
          schema:
            type: string
            format: uuid
        - name: sortBy
          in: query
          description: Field to sort by
          schema:
            type: string
            enum: [createdAt, updatedAt, resolvedAt, priority, status]
            default: createdAt
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Tickets list
          content:
            application/json:
              schema:
                type: object
                properties:
                  tickets:
                    type: array
                    items:
                      $ref: '#/components/schemas/TicketExpanded'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Create ticket
      description: |
        Creates a new ticket with the provided title, description, and priority.
        
        Automatically:
        - Sets requester to the authenticated user
        - Assigns to the user's organization
        - Calculates SLA due dates based on priority and category
        - Schedules SLA breach detection jobs
        - Creates initial audit event
        
        Requires: title (min 3 chars), descriptionMd (min 3 chars), priority.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketCreate'
      responses:
        '200':
          description: Ticket created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ticket:
                    $ref: '#/components/schemas/Ticket'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/tickets/{id}:
    patch:
      summary: Update ticket
      description: |
        Updates ticket fields (status, priority, assignees) with role-based authorization.
        
        Authorization:
        - REQUESTER: Can only close/reopen their own tickets
        - AGENT/ADMIN: Can update all fields within their organization
        
        Automatically:
        - Reschedules SLA jobs if due dates change
        - Creates audit events for all changes
        - Triggers automation rules on status/priority changes
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketUpdate'
      responses:
        '200':
          description: Ticket updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  ticket:
                    $ref: '#/components/schemas/TicketExpanded'
        '400':
          description: Validation or no changes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Not found or other organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    put:
      summary: Replace ticket (same semantics as PATCH)
      description: Mirrors PATCH behavior and validations.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TicketUpdate'
      responses:
        '200':
          description: Ticket updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  ticket:
                    $ref: '#/components/schemas/TicketExpanded'
        '400':
          description: Validation or no changes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Not found or other organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/tickets/{id}/comments:
    post:
      summary: Create comment
      description: Creates a comment; organization scope is not enforced in the current handler.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreate'
      responses:
        '200':
          description: Comment created
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/audit-events:
    get:
      summary: List admin audit events
      description: Returns paginated admin audit events for the organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: resourceId
          in: query
          schema:
            type: string
          description: Filter by resource ID
        - name: actorId
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by actor user ID
      responses:
        '200':
          description: Audit events list
          content:
            application/json:
              schema:
                type: object
                properties:
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/AdminAuditEvent'
                  page:
                    $ref: '#/components/schemas/PageInfo'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/users:
    get:
      summary: List users
      description: Returns all users in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Users list
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserSummary'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Create user
      description: Creates a new user in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/UserSummary'
        '400':
          description: Validation error or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/users/{id}:
    get:
      summary: Get user
      description: Returns a specific user. Requires ADMIN role and user must be in admin's organization.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/UserSummary'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    patch:
      summary: Update user
      description: Updates a user in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/UserSummary'
        '400':
          description: Validation error or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    delete:
      summary: Delete user
      description: Deletes a user from the admin's organization. Cannot delete users with active tickets or self. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '400':
          description: Cannot delete user (active tickets or self)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/teams:
    get:
      summary: List teams
      description: Returns all teams in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Teams list
          content:
            application/json:
              schema:
                type: object
                properties:
                  teams:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamSummary'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Create team
      description: Creates a new team in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamCreate'
      responses:
        '201':
          description: Team created
          content:
            application/json:
              schema:
                type: object
                properties:
                  team:
                    $ref: '#/components/schemas/TeamSummary'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/teams/{id}:
    get:
      summary: Get team
      description: Returns a specific team. Requires ADMIN role and team must be in admin's organization.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Team details
          content:
            application/json:
              schema:
                type: object
                properties:
                  team:
                    $ref: '#/components/schemas/TeamSummary'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Team not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    patch:
      summary: Update team
      description: Updates a team in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamUpdate'
      responses:
        '200':
          description: Team updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  team:
                    $ref: '#/components/schemas/TeamSummary'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Team not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    delete:
      summary: Delete team
      description: Deletes a team from the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Team deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Team not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/teams/{id}/memberships:
    get:
      summary: List team memberships
      description: Returns all memberships for a specific team. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Team memberships
          content:
            application/json:
              schema:
                type: object
                properties:
                  memberships:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamMembership'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Team not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Add team member
      description: Adds a user to a team. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId]
              properties:
                userId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Member added
          content:
            application/json:
              schema:
                type: object
                properties:
                  membership:
                    $ref: '#/components/schemas/TeamMembership'
        '400':
          description: Validation error or user already in team
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Team or user not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    delete:
      summary: Remove team member
      description: Removes a user from a team. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Member removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Team or membership not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/notifications:
    get:
      summary: List notifications
      description: Returns notifications for the authenticated user, ordered by creation date.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Notifications list
          content:
            application/json:
              schema:
                type: object
                properties:
                  notifications:
                    type: array
                    items:
                      $ref: '#/components/schemas/InAppNotification'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/notifications/{id}/read:
    patch:
      summary: Mark notification as read
      description: Marks a specific notification as read for the authenticated user.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Notification marked as read
          content:
            application/json:
              schema:
                type: object
                properties:
                  notification:
                    $ref: '#/components/schemas/InAppNotification'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Notification not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/tickets/{id}/attachments:
    get:
      summary: List ticket attachments
      description: Returns all attachments for a specific ticket.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Attachments list
          content:
            application/json:
              schema:
                type: object
                properties:
                  attachments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Attachment'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Ticket not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Upload attachment
      description: Initiates attachment upload for a ticket. Returns presigned URL for upload.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttachmentUploadRequest'
      responses:
        '200':
          description: Upload initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentUploadResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Ticket not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/tickets/{id}/attachments/{attachmentId}:
    get:
      summary: Get attachment
      description: Returns attachment details and download URL.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: attachmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Attachment details
          content:
            application/json:
              schema:
                type: object
                properties:
                  attachment:
                    $ref: '#/components/schemas/Attachment'
                  downloadUrl:
                    type: string
                    description: Presigned URL for download
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Ticket or attachment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    delete:
      summary: Delete attachment
      description: Deletes an attachment from a ticket.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: attachmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Attachment deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Ticket or attachment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/tickets/{id}/audit:
    get:
      summary: Get ticket audit timeline
      description: Returns audit events for a specific ticket.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Audit events
          content:
            application/json:
              schema:
                type: object
                properties:
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditEvent'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Ticket not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/tickets/{id}/csat:
    post:
      summary: Submit CSAT response
      description: Submits customer satisfaction rating and optional feedback for a ticket.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CsatResponse'
      responses:
        '200':
          description: CSAT response recorded
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Ticket not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/categories:
    get:
      summary: List categories
      description: Returns all ticket categories for the user's organization.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Categories list
          content:
            application/json:
              schema:
                type: object
                properties:
                  categories:
                    type: array
                    items:
                      $ref: '#/components/schemas/Category'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/tags:
    get:
      summary: List tags
      description: Returns all tags for the user's organization.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Tags list
          content:
            application/json:
              schema:
                type: object
                properties:
                  tags:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tag'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/sla/preview:
    post:
      summary: Preview SLA deadlines
      description: Calculates SLA deadlines for a given priority and optional category.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlaPreviewRequest'
      responses:
        '200':
          description: SLA preview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlaPreviewResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/health:
    get:
      summary: Health check
      description: |
        Health check endpoint that verifies connectivity to:
        - Database (PostgreSQL via Prisma) - required
        - Redis (via BullMQ) - optional, checked if REDIS_URL is set
        - MinIO (via HTTP health endpoint) - optional, checked if MINIO_ENDPOINT is set
        
        Returns 200 OK if all checked services are healthy, 503 Service Unavailable if any required service is unhealthy.
      responses:
        '200':
          description: All services healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  database:
                    type: boolean
                  redis:
                    type: boolean
                  minio:
                    type: boolean
                  timestamp:
                    type: string
                    format: date-time
        '503':
          description: Service unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  database:
                    type: boolean
                  redis:
                    type: boolean
                  minio:
                    type: boolean
                  timestamp:
                    type: string
                    format: date-time
  /api/tickets/bulk:
    patch:
      summary: Bulk update tickets
      description: |
        Performs bulk operations on multiple tickets (assign or status change).
        
        Authorization:
        - AGENT/ADMIN only
        - All tickets must belong to user's organization
        
        Supports:
        - Bulk assignment (assign action with userId value)
        - Bulk status change (status action with status value)
        
        Returns partial success results if some tickets fail.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ticketIds, action, value]
              properties:
                ticketIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  minItems: 1
                  maxItems: 100
                action:
                  type: string
                  enum: [assign, status]
                value:
                  type: string
                  description: User ID for assign action, status enum value for status action
      responses:
        '200':
          description: Bulk operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: integer
                  failed:
                    type: integer
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        ticketId:
                          type: string
                          format: uuid
                        error:
                          type: string
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/views:
    get:
      summary: List saved views
      description: Returns saved views for the authenticated user, including user's own views and team views in the organization.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Saved views list
          content:
            application/json:
              schema:
                type: object
                properties:
                  views:
                    type: array
                    items:
                      $ref: '#/components/schemas/SavedView'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Create saved view
      description: Creates a new saved view for the authenticated user. Prevents duplicate names per user.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, filters]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 50
                filters:
                  type: object
                  properties:
                    status:
                      type: string
                      enum: [NOWE, W_TOKU, OCZEKUJE_NA_UZYTKOWNIKA, WSTRZYMANE, ROZWIAZANE, ZAMKNIETE, PONOWNIE_OTWARTE]
                    priority:
                      type: string
                      enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
                    search:
                      type: string
                    category:
                      type: string
                    tagIds:
                      type: array
                      items:
                        type: string
                        format: uuid
                isShared:
                  type: boolean
                  default: false
                isTeam:
                  type: boolean
                  default: false
      responses:
        '200':
          description: View created
          content:
            application/json:
              schema:
                type: object
                properties:
                  view:
                    $ref: '#/components/schemas/SavedView'
        '400':
          description: Validation error or duplicate name
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/views/{id}:
    patch:
      summary: Update saved view
      description: Updates a saved view. User can only update their own views or team views they have access to.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 50
                filters:
                  type: object
                  additionalProperties: true
                isShared:
                  type: boolean
                isTeam:
                  type: boolean
      responses:
        '200':
          description: View updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  view:
                    $ref: '#/components/schemas/SavedView'
        '400':
          description: Validation error or duplicate name
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: View not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    delete:
      summary: Delete saved view
      description: Deletes a saved view. User can only delete their own views or team views they have access to.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: View deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: View not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/views/{id}/set-default:
    post:
      summary: Set view as default
      description: Sets a saved view as the default view for the user. Unsets all other default views for the user.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: View set as default
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: View not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/automation-rules:
    get:
      summary: List automation rules
      description: Returns all automation rules for the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Automation rules list
          content:
            application/json:
              schema:
                type: object
                properties:
                  rules:
                    type: array
                    items:
                      $ref: '#/components/schemas/AutomationRule'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Create automation rule
      description: Creates a new automation rule in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutomationRuleCreate'
      responses:
        '201':
          description: Automation rule created
          content:
            application/json:
              schema:
                type: object
                properties:
                  rule:
                    $ref: '#/components/schemas/AutomationRule'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/automation-rules/{id}:
    patch:
      summary: Update automation rule
      description: Updates an automation rule in the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutomationRuleUpdate'
      responses:
        '200':
          description: Automation rule updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  rule:
                    $ref: '#/components/schemas/AutomationRule'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Automation rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    delete:
      summary: Delete automation rule
      description: Deletes an automation rule from the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Automation rule deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Automation rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/sla-policies:
    get:
      summary: List SLA policies
      description: Returns all SLA policies for the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: SLA policies list
          content:
            application/json:
              schema:
                type: object
                properties:
                  policies:
                    type: array
                    items:
                      $ref: '#/components/schemas/SlaPolicy'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    post:
      summary: Create SLA policy
      description: Creates a new SLA policy in the admin's organization. Requires ADMIN role. Prevents duplicate policies for the same priority/category combination.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlaPolicyCreate'
      responses:
        '201':
          description: SLA policy created
          content:
            application/json:
              schema:
                type: object
                properties:
                  policy:
                    $ref: '#/components/schemas/SlaPolicy'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '409':
          description: Policy already exists for this priority/category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/admin/sla-policies/{id}:
    patch:
      summary: Update SLA policy
      description: Updates an SLA policy in the admin's organization. Requires ADMIN role. Prevents duplicate policies for the same priority/category combination.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlaPolicyUpdate'
      responses:
        '200':
          description: SLA policy updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  policy:
                    $ref: '#/components/schemas/SlaPolicy'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: SLA policy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '409':
          description: Policy already exists for this priority/category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
    delete:
      summary: Delete SLA policy
      description: Deletes an SLA policy from the admin's organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: SLA policy deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: SLA policy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/reports/kpi:
    get:
      summary: Get KPI metrics
      description: Returns KPI metrics for the organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: startDate
          in: query
          description: Start date for metrics calculation (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date for metrics calculation (ISO 8601)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: KPI metrics
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/reports/analytics:
    get:
      summary: Get analytics data
      description: Returns analytics data for the organization. Requires ADMIN role. Supports both days parameter and custom date range.
      security:
        - cookieAuth: []
      parameters:
        - name: days
          in: query
          description: Number of days to analyze (7-365, default: 30)
          schema:
            type: integer
            minimum: 7
            maximum: 365
            default: 30
        - name: startDate
          in: query
          description: Start date for analytics (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date for analytics (ISO 8601)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Analytics data
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '400':
          description: Invalid date format or range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/reports/csat:
    get:
      summary: Get CSAT analytics
      description: Returns CSAT analytics for the organization. Requires ADMIN role.
      security:
        - cookieAuth: []
      parameters:
        - name: startDate
          in: query
          description: Start date for CSAT analysis (ISO 8601, default: 30 days ago)
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date for CSAT analysis (ISO 8601, default: now)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: CSAT analytics
          content:
            application/json:
              schema:
                type: object
                properties:
                  period:
                    type: object
                    properties:
                      startDate:
                        type: string
                        format: date-time
                      endDate:
                        type: string
                        format: date-time
                  summary:
                    type: object
                    properties:
                      totalResponses:
                        type: integer
                      averageScore:
                        type: number
                      responseRate:
                        type: number
                      totalResolvedTickets:
                        type: integer
                      distribution:
                        type: object
                        additionalProperties:
                          type: integer
                      byPriority:
                        type: object
                        additionalProperties:
                          type: object
                          properties:
                            count:
                              type: integer
                            average:
                              type: number
                      byCategory:
                        type: object
                        additionalProperties:
                          type: object
                          properties:
                            count:
                              type: integer
                            average:
                              type: number
                  responses:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        ticketNumber:
                          type: integer
                        ticketId:
                          type: string
                          format: uuid
                        score:
                          type: integer
                          minimum: 1
                          maximum: 5
                        comment:
                          type: string
                          nullable: true
                        createdAt:
                          type: string
                          format: date-time
                        ticketPriority:
                          type: string
                          enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
                        ticketCategory:
                          type: string
                          nullable: true
        '400':
          description: Invalid date format or range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/reports/export/tickets:
    get:
      summary: Export tickets to CSV
      description: Exports tickets to CSV format. Available to AGENT and ADMIN roles only. Supports filtering by status, priority, search, category, tags, and date ranges.
      security:
        - cookieAuth: []
      parameters:
        - name: status
          in: query
          description: Filter by ticket status
          schema:
            type: string
            enum: [NOWE, W_TOKU, OCZEKUJE_NA_UZYTKOWNIKA, WSTRZYMANE, ROZWIAZANE, ZAMKNIETE, PONOWNIE_OTWARTE]
        - name: priority
          in: query
          description: Filter by ticket priority
          schema:
            type: string
            enum: [NISKI, SREDNI, WYSOKI, KRYTYCZNY]
        - name: search
          in: query
          description: Search in title and description
          schema:
            type: string
        - name: category
          in: query
          description: Filter by category ID
          schema:
            type: string
        - name: tags
          in: query
          description: Comma-separated tag IDs
          schema:
            type: string
        - name: startDate
          in: query
          description: Filter tickets created on or after this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: Filter tickets created on or before this date (ISO 8601)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: CSV file with tickets
          content:
            text/csv:
              schema:
                type: string
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden (export not available for requesters)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
  /api/reports/export/comments:
    get:
      summary: Export comments to CSV
      description: Exports comments to CSV format. Supports filtering by ticket, date range, and internal comments (agents/admins only).
      security:
        - cookieAuth: []
      parameters:
        - name: ticketId
          in: query
          description: Filter by specific ticket ID
          schema:
            type: string
            format: uuid
        - name: startDate
          in: query
          description: Filter comments created on or after this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: Filter comments created on or before this date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: internal
          in: query
          description: Include internal comments (must be "true", agents/admins only)
          schema:
            type: string
            enum: [true]
      responses:
        '200':
          description: CSV file with comments
          content:
            text/csv:
              schema:
                type: string
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
        '404':
          description: Ticket not found or access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorAsIs'
